# Database Seeder Guide

## ğŸ¯ Overview

Comprehensive Prisma seeder that populates the database with realistic fake data using `@faker-js/faker`.

---

## ğŸ“¦ What Gets Seeded

### **Data Summary:**

| Model | Count | Description |
|-------|-------|-------------|
| **Users** | 52 | 50 regular + 1 admin + 1 moderator |
| **Properties** | 100 | Various types with images, videos, documents |
| **Subscription Plans** | 4 | 1m, 3m, 6m, 12m premium plans |
| **Subscriptions** | 20 | Active user subscriptions |
| **Reviews** | 80 | Property reviews (pending/approved/rejected) |
| **Transactions** | 60 | Payment transactions |
| **Property Views** | 500 | View tracking records |
| **Saved Properties** | ~100 | User favorites |
| **Property Images** | 200-500 | 2-5 images per property |
| **Property Videos** | ~30 | Video tours (30% of properties) |
| **Property Documents** | 100-300 | PDF documents (1-3 per property) |
| **System Settings** | 23 | Platform configuration |

---

## ğŸš€ Installation & Setup

### **Step 1: Install Dependencies**

```bash
cd backend
npm install
```

This will install `@faker-js/faker` which is already added to `package.json`.

### **Step 2: Run Prisma Migration**

**IMPORTANT:** Run the migration first to create the new tables:

```bash
npx prisma migrate dev --name add_reviews_transactions_settings
```

### **Step 3: Generate Prisma Client**

```bash
npx prisma generate
```

---

## ğŸŒ± Running the Seeder

### **Method 1: Using npm script (Recommended)**

```bash
npm run prisma:seed
```

### **Method 2: Direct execution**

```bash
npx prisma db seed
```

### **Method 3: Using ts-node directly**

```bash
npx ts-node prisma/seed.ts
```

---

## ğŸ“Š Seeder Output

You'll see progress messages like:

```
ğŸŒ± Starting database seeding...
ğŸ—‘ï¸  Cleaning database...
ğŸ“‹ Creating subscription plans...
âœ… Created 4 subscription plans
ğŸ‘¤ Creating admin user...
âœ… Admin user created
ğŸ‘¤ Creating moderator user...
âœ… Moderator user created
ğŸ‘¥ Creating regular users...
âœ… Created 50 regular users
ğŸ’³ Creating subscriptions...
âœ… Created 20 subscriptions
ğŸ¢ Creating properties...
âœ… Created 100 properties with images, videos, and documents
ğŸ‘ï¸  Creating property views...
âœ… Created 500 property views
â­ Creating saved properties...
âœ… Created saved properties
â­ Creating reviews...
âœ… Created 80 reviews
ğŸ’° Creating transactions...
âœ… Created 60 transactions
âš™ï¸  Creating system settings...
âœ… Created 23 system settings

ğŸ“Š Seeding Summary:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ‘¥ Users: 52 (50 regular + 1 admin + 1 moderator)
ğŸ¢ Properties: 100
ğŸ“‹ Subscription Plans: 4
ğŸ’³ Subscriptions: 20
â­ Reviews: 80
ğŸ’° Transactions: 60
ğŸ‘ï¸  Property Views: 500
âš™ï¸  System Settings: 23
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

âœ… Database seeding completed successfully!
```

---

## ğŸ‘¥ Test Credentials

### **Admin User**
- **Phone**: `+998901234567` or `998901234567`
- **SMS Code**: Check backend console in dev mode
- **Role**: admin
- **Name**: ĞĞ´Ğ¼Ğ¸Ğ½Ğ¸ÑÑ‚Ñ€Ğ°Ñ‚Ğ¾Ñ€ Ğ¡Ğ¸ÑÑ‚ĞµĞ¼Ñ‹
- **Email**: admin@realestate.uz

### **Moderator User**
- **Phone**: `+998901234568` or `998901234568`
- **SMS Code**: Check backend console in dev mode
- **Role**: moderator
- **Name**: ĞœĞ¾Ğ´ĞµÑ€Ğ°Ñ‚Ğ¾Ñ€ ĞŸĞ»Ğ°Ñ‚Ñ„Ğ¾Ñ€Ğ¼Ñ‹
- **Email**: moderator@realestate.uz

**Note:** The auth system normalizes phone numbers by removing non-digits and ensuring they start with `998`. So `+998901234567` and `998901234567` are treated as the same number.

### **Regular Users**
- 50 users with random phone numbers
- Phone format: `+99890XXXXXXX`
- Random names and emails generated by Faker

---

## ğŸ¢ Property Data

### **Property Types:**
- `office` - ĞÑ„Ğ¸ÑÑ‹
- `warehouse` - Ğ¡ĞºĞ»Ğ°Ğ´Ñ‹
- `retail` - Ğ¢Ğ¾Ñ€Ğ³Ğ¾Ğ²Ñ‹Ğµ Ğ¿Ğ¾Ğ¼ĞµÑ‰ĞµĞ½Ğ¸Ñ
- `land` - Ğ—ĞµĞ¼ĞµĞ»ÑŒĞ½Ñ‹Ğµ ÑƒÑ‡Ğ°ÑÑ‚ĞºĞ¸
- `production` - ĞŸÑ€Ğ¾Ğ¸Ğ·Ğ²Ğ¾Ğ´ÑÑ‚Ğ²ĞµĞ½Ğ½Ñ‹Ğµ Ğ¿Ğ¾Ğ¼ĞµÑ‰ĞµĞ½Ğ¸Ñ

### **Deal Types:**
- `sale` - ĞŸÑ€Ğ¾Ğ´Ğ°Ğ¶Ğ°
- `rent` - ĞÑ€ĞµĞ½Ğ´Ğ°

### **Property Statuses:**
- `active` - ĞĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹Ğµ (verified)
- `pending` - ĞĞ° Ğ¼Ğ¾Ğ´ĞµÑ€Ğ°Ñ†Ğ¸Ğ¸
- `rejected` - ĞÑ‚ĞºĞ»Ğ¾Ğ½ĞµĞ½Ğ½Ñ‹Ğµ
- `sold` - ĞŸÑ€Ğ¾Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ

### **Cities:**
- Ğ¢Ğ°ÑˆĞºĞµĞ½Ñ‚
- Ğ¡Ğ°Ğ¼Ğ°Ñ€ĞºĞ°Ğ½Ğ´
- Ğ‘ÑƒÑ…Ğ°Ñ€Ğ°
- ĞĞ½Ğ´Ğ¸Ğ¶Ğ°Ğ½
- ĞĞ°Ğ¼Ğ°Ğ½Ğ³Ğ°Ğ½
- Ğ¤ĞµÑ€Ğ³Ğ°Ğ½Ğ°

### **Tashkent Districts:**
- ĞœĞ¸Ñ€Ğ·Ğ¾-Ğ£Ğ»ÑƒĞ³Ğ±ĞµĞºÑĞºĞ¸Ğ¹
- Ğ§Ğ¸Ğ»Ğ°Ğ½Ğ·Ğ°Ñ€ÑĞºĞ¸Ğ¹
- Ğ¡ĞµÑ€Ğ³ĞµĞ»Ğ¸Ğ¹ÑĞºĞ¸Ğ¹
- Ğ¯ĞºĞºĞ°ÑĞ°Ñ€Ğ°Ğ¹ÑĞºĞ¸Ğ¹
- Ğ®Ğ½ÑƒÑĞ°Ğ±Ğ°Ğ´ÑĞºĞ¸Ğ¹
- Ğ¨Ğ°Ğ¹Ñ…Ğ°Ğ½Ñ‚Ğ°Ñ…ÑƒÑ€ÑĞºĞ¸Ğ¹
- ĞĞ»Ğ¼Ğ°Ğ·Ğ°Ñ€ÑĞºĞ¸Ğ¹
- Ğ¯ÑˆĞ½Ğ°Ğ±Ğ°Ğ´ÑĞºĞ¸Ğ¹

### **Property Features:**
- Area: 50-2000 mÂ²
- Price: 5,000-50,000 UZS per mÂ²
- Floor: 1-20 (for non-land properties)
- Total Floors: 1-25
- Rooms: 1-20 (for offices)
- Parking: Random
- Video: 30% chance
- 360 Tour: Random
- Top Listing: 20% chance
- Views: 0-1000

---

## ğŸ’³ Subscription Plans

### **1. Premium 1 Ğ¼ĞµÑÑÑ†**
- **Code**: `premium_1m`
- **Price**: 50,000 UZS
- **Duration**: 30 days
- **Features**: Full access, video viewing, 360 tours

### **2. Premium 3 Ğ¼ĞµÑÑÑ†Ğ°**
- **Code**: `premium_3m`
- **Price**: 120,000 UZS (20% discount)
- **Duration**: 90 days
- **Features**: Full access + 20% discount

### **3. Premium 6 Ğ¼ĞµÑÑÑ†ĞµĞ²**
- **Code**: `premium_6m`
- **Price**: 200,000 UZS (33% discount)
- **Duration**: 180 days
- **Features**: Full access + 33% discount

### **4. Premium 1 Ğ³Ğ¾Ğ´**
- **Code**: `premium_12m`
- **Price**: 350,000 UZS (42% discount)
- **Duration**: 365 days
- **Features**: Full access + 42% discount + priority support

---

## â­ Reviews

- **Total**: 80 reviews
- **Ratings**: 1-5 stars
- **Statuses**:
  - `pending` - Awaiting moderation
  - `approved` - Approved by moderator
  - `rejected` - Rejected by moderator
- **Comments**: Generated by Faker (lorem ipsum)
- **Moderation**: Approved/rejected reviews have moderator ID and timestamp

---

## ğŸ’° Transactions

- **Total**: 60 transactions
- **Statuses**:
  - `pending` - Payment pending
  - `completed` - Payment successful
  - `failed` - Payment failed
  - `refunded` - Payment refunded
- **Payment Methods**:
  - `payme` - Payme
  - `click` - Click
  - `uzum` - Uzum
  - `card` - Bank card
  - `cash` - Cash
- **Currency**: UZS
- **Transaction ID**: 20-character alphanumeric

---

## âš™ï¸ System Settings

### **General (6 settings)**
- `general_siteName`: "Commercial Real Estate"
- `general_siteDescription`: "ĞŸĞ»Ğ°Ñ‚Ñ„Ğ¾Ñ€Ğ¼Ğ° ĞºĞ¾Ğ¼Ğ¼ĞµÑ€Ñ‡ĞµÑĞºĞ¾Ğ¹ Ğ½ĞµĞ´Ğ²Ğ¸Ğ¶Ğ¸Ğ¼Ğ¾ÑÑ‚Ğ¸ Ğ£Ğ·Ğ±ĞµĞºĞ¸ÑÑ‚Ğ°Ğ½Ğ°"
- `general_contactEmail`: "info@realestate.uz"
- `general_contactPhone`: "+998712345678"
- `general_timezone`: "Asia/Tashkent"
- `general_language`: "ru"

### **Notifications (4 settings)**
- `notifications_emailEnabled`: true
- `notifications_smsEnabled`: true
- `notifications_newPropertyAlert`: true
- `notifications_priceChangeAlert`: true

### **Security (4 settings)**
- `security_twoFactorEnabled`: false
- `security_sessionTimeout`: 3600
- `security_maxLoginAttempts`: 5
- `security_passwordMinLength`: 8

### **Properties (4 settings)**
- `properties_autoApprove`: false
- `properties_maxImages`: 10
- `properties_requireVerification`: true
- `properties_topListingDays`: 30

### **Payments (4 settings)**
- `payments_payme_enabled`: true
- `payments_click_enabled`: true
- `payments_uzum_enabled`: true
- `payments_commission_rate`: 5

---

## ğŸ”„ Re-running the Seeder

### **âš ï¸ WARNING: Data Cleanup**

The seeder **DELETES ALL EXISTING DATA** before seeding. This includes:
- All reviews
- All transactions
- All system settings
- All property views
- All saved properties
- All property images, videos, documents
- All subscriptions
- All properties
- All subscription plans
- All users

### **To Keep Existing Data:**

Comment out the cleanup section in `seed.ts`:

```typescript
// Comment out these lines to keep existing data:
/*
await prisma.review.deleteMany();
await prisma.transaction.deleteMany();
// ... etc
*/
```

---

## ğŸ§ª Testing the Seeded Data

### **1. Check Database**

```bash
npx prisma studio
```

This opens Prisma Studio where you can browse all seeded data.

### **2. Test Login**

Start the backend and try logging in:

```bash
npm run start:dev
```

Login with admin credentials:
- Phone: `+998901234567`
- SMS Code: `123456`

### **3. Test Dashboard**

Start the dashboard and verify all pages load with data:

```bash
cd dashboard
npm run dev
```

Visit:
- Overview page - Should show stats
- Properties page - Should show 100 properties
- Users page - Should show 52 users
- Reviews page - Should show 80 reviews
- Payments page - Should show 60 transactions
- Settings page - Should show 23 settings

### **4. Test API Endpoints**

```bash
# Get properties
curl http://localhost:3001/api/admin/properties

# Get users
curl http://localhost:3001/api/admin/users

# Get reviews
curl http://localhost:3001/api/admin/reviews

# Get transactions
curl http://localhost:3001/api/admin/transactions

# Get settings
curl http://localhost:3001/api/admin/settings
```

---

## ğŸ› Troubleshooting

### **Error: "Cannot find module '@faker-js/faker'"**

**Solution:**
```bash
cd backend
npm install
```

### **Error: "Property 'review' does not exist"**

**Solution:** Run Prisma migration first:
```bash
npx prisma migrate dev
npx prisma generate
```

### **Error: "Seeding failed"**

**Solution:** Check the error message. Common issues:
- Database not running
- Migration not applied
- Prisma client not generated
- Connection string incorrect

### **Slow Seeding**

The seeder creates 100 properties with images, videos, and documents. This can take 1-3 minutes depending on your system.

**To speed up:**
- Reduce property count (change `100` to `50` on line 151)
- Reduce image count (change `max: 5` to `max: 2` on line 194)
- Reduce views count (change `500` to `100` on line 233)

---

## ğŸ“ Customization

### **Change Data Counts**

Edit these values in `seed.ts`:

```typescript
// Line 112: Number of regular users
for (let i = 0; i < 50; i++) {

// Line 128: Number of subscriptions
const subscriptionsCount = 20;

// Line 151: Number of properties
for (let i = 0; i < 100; i++) {

// Line 194: Images per property
const imageCount = faker.number.int({ min: 2, max: 5 });

// Line 217: Documents per property
const docCount = faker.number.int({ min: 1, max: 3 });

// Line 233: Property views
const viewsCount = 500;

// Line 250: Saved properties
const savedCount = 100;

// Line 270: Reviews
const reviewsCount = 80;

// Line 292: Transactions
const transactionsCount = 60;
```

### **Add More Cities**

Edit line 7:

```typescript
const cities = ['Ğ¢Ğ°ÑˆĞºĞµĞ½Ñ‚', 'Ğ¡Ğ°Ğ¼Ğ°Ñ€ĞºĞ°Ğ½Ğ´', 'Ğ‘ÑƒÑ…Ğ°Ñ€Ğ°', 'ĞĞ½Ğ´Ğ¸Ğ¶Ğ°Ğ½', 'ĞĞ°Ğ¼Ğ°Ğ½Ğ³Ğ°Ğ½', 'Ğ¤ĞµÑ€Ğ³Ğ°Ğ½Ğ°', 'Ğ¥Ğ¸Ğ²Ğ°', 'ĞšĞ°Ñ€ÑˆĞ¸'];
```

### **Change Property Types**

Edit line 13:

```typescript
const propertyTypes = ['office', 'warehouse', 'retail', 'land', 'production', 'hotel'];
```

---

## âœ… Post-Seeding Checklist

- [ ] Seeder ran successfully without errors
- [ ] Database contains expected number of records
- [ ] Admin user can log in
- [ ] Dashboard loads with real data
- [ ] Properties page shows 100 properties
- [ ] Users page shows 52 users
- [ ] Reviews page shows 80 reviews
- [ ] Payments page shows 60 transactions
- [ ] Settings page shows 23 settings
- [ ] Property images display correctly
- [ ] Analytics page shows charts with data

---

## ğŸ¯ Next Steps

After seeding:

1. **Test all dashboard features**
   - Property moderation
   - User management
   - Review moderation
   - Transaction viewing
   - Settings management

2. **Test pagination**
   - Properties list
   - Users list
   - Reviews list
   - Transactions list

3. **Test search and filters**
   - Search properties
   - Filter by status
   - Filter by city
   - Filter by type

4. **Test analytics**
   - View statistics
   - Generate reports
   - Export data

---

**Created:** January 19, 2026
**Last Updated:** January 19, 2026
**Status:** âœ… Ready to use
